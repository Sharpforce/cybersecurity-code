FROM node:23.7.0-alpine3.20

WORKDIR /usr/src/app

RUN apk add --no-cache shadow

RUN useradd --create-home --shell /bin/bash appuser

COPY package*.json ./
RUN npm install --omit=dev

RUN mkdir -p ./views

COPY ./src/views/400.html ./views/400.html
COPY ./src/views/403.html ./views/403.html
COPY ./src/views/500.html ./views/500.html
COPY ./src/views/admin.html ./views/admin.html
COPY ./src/views/index.html ./views/index.html
COPY ./src/app.js ./

RUN chown -R appuser:appuser /usr/src/app

EXPOSE 3000

USER appuser

CMD ["npm", "start"]